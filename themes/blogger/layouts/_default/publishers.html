{{ define "main" }}
<article class="post">
    <header class="post-header">
        <h1 class="post-title">{{ .Title }}</h1>
        {{ with .Params.description }}
        <p class="post-subtitle">{{ . }}</p>
        {{ end }}
    </header>

    <div class="post-content">
        {{ .Content }}

        <div class="sources-list">
            {{ $publishers := slice }}
            {{ range where .Site.RegularPages "Section" "noted" }}
                {{ with .Params.isBasedOn.publisher }}
                    {{ $publishers = $publishers | append . }}
                {{ end }}
            {{ end }}
            {{ $uniquePublishers := sort ($publishers | uniq) }}
            {{ range $uniquePublishers }}
                {{ $publisher := . }}
                {{ $count := 0 }}
                {{ range where $.Site.RegularPages "Section" "noted" }}
                    {{ if eq .Params.isBasedOn.publisher $publisher }}
                        {{ $count = add $count 1 }}
                    {{ end }}
                {{ end }}
                <a class="source-item" href="{{ printf "/?q=%s" (urlquery $publisher) | relURL }}">
                    <span class="source-name">{{ $publisher }}</span>
                    <span class="source-count">{{ $count }} {{ if eq $count 1 }}post{{ else }}posts{{ end }}</span>
                </a>
            {{ end }}
        </div>
    </div>
</article>
{{ end }}
